[workspace]
members = ["cargo:."]

# Config for 'dist'
[dist]
# The preferred dist version to use in CI (Cargo.toml SemVer syntax)
cargo-dist-version = "0.30.4"
# CI backends to support
ci = "github"
# The installers to generate for each app
installers = []
# Target platforms to build apps for (Rust target-triple syntax)
# Targets built via Nix in build-release-binaries.yml (native, no cross-compilation)
targets = [
  "aarch64-apple-darwin",
  "aarch64-unknown-linux-gnu",
  "aarch64-unknown-linux-musl",
  "x86_64-unknown-linux-gnu",
  "x86_64-unknown-linux-musl",
]
# Where to host releases
hosting = "github"

# Use manual workflow_dispatch releases instead of tag pushes
dispatch-releases = true

# Do not use cargo-dist's default build matrix; use custom Nix build job instead
build-local-artifacts = false
local-artifacts-jobs = ["./build-release-binaries"]

# Publish crates via a custom job after hosting
publish-jobs = ["./publish-crates"]

# Permissions needed by custom jobs in GitHub Actions
github-custom-job-permissions = { "build-release-binaries" = { id-token = "write", contents = "read" }, "publish-crates" = { contents = "read" } }

# Don't run on PRs
pr-run-mode = "skip"

# Allow manual edits to the generated release.yml (e.g. passing tag input to custom jobs)
allow-dirty = ["ci"]
